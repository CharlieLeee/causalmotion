# Towards Adaptive Motion Forecasting: A Causal Representation Perspective 



## Introduction

Promote transferability of motion forecasting models under **style shifts** from a causal perspective.


## Requirements
```
pip install --upgrade pip

pip install -r requirements.txt

pip3 install torch==1.9.0+cu111 -f https://download.pytorch.org/whl/torch_stable.html
```


## Dataset

Synthetic data (`v4`) generated by ORCA can be dowloaded at `https://drive.google.com/file/d/1OQfZ1Y8XkFhZY8NE_TsSiDwwcvjCIECa/view?usp=sharingare`, and need to be saved in `/datasets/`. 


## Pre-Training
Train Baseline or our modular architecture with Empirical Risk Minimization (ERM) or Invariant Risk Minimization (IRM).
```
sh scripts/pretrain.sh
```

Pretrained models on dataset `v4` for all the methods with seed=1,2,3,4,5 are already saved in `/models/v4/pretrain/`.

Evaluate pretrained model.
```
sh scripts/evaluate_pretrain.sh
```
Save all the quantitative results in `results/{dataset_name}/pretrain/summary.csv`.
```
sh scripts/extract_pretrain.sh
```

## Finetune
Finetune Baseline or our modular architecture with Empirical Risk Minimization (ERM) on few samples of a new environment.
```
sh scripts/finetune.sh
```

Finetuned models on dataset `v4` for all the methods with seed=1,2,3,4,5 are already saved in `/models/v4/finetune/`.

Evaluate finetuned model.
```
sh scripts/evaluate_finetune.sh
```

Save all the quantitative results in `results/{dataset_name}/finetune/summary.csv`.
```
sh scripts/extract_finetune.sh
```

## Refinement
Test Time refinement of the predictions on the fly. Instead of simply evaluating the ADE of the predictions, we optimize the latent space to make the prediction's style more similar to the style of the env (using contrastive loss)
```
sh scripts/refine.sh
```

We can either enforce the prediction to follow more the style of the env, or to make the prediction follow another style (with `--wrongstyle true`). The number of steps can be precised with `--ttr` parameter. 
